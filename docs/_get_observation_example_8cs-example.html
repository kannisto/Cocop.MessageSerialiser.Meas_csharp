<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cocop.MessageSerialiser.Meas (C#): GetObservationExample.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cocop.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cocop.MessageSerialiser.Meas (C#)
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
   <div id="projectbrief">API to encode industrial data as standard-based messages</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GetObservationExample.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Please make sure to read and understand README.md and LICENSE.txt.</span></div><div class="line"><span class="comment">// </span></div><div class="line"><span class="comment">// This file was prepared in the research project COCOP (Coordinating</span></div><div class="line"><span class="comment">// Optimisation of Complex Industrial Processes).</span></div><div class="line"><span class="comment">// https://cocop-spire.eu/</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Author: Petri Kannisto, Tampere University, Finland</span></div><div class="line"><span class="comment">// File created: 2/2020</span></div><div class="line"><span class="comment">// Last modified: 3/2020</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>;</div><div class="line"><span class="keyword">using</span> MsgMeas = <a class="code" href="namespace_cocop.html">Cocop</a>.<a class="code" href="namespace_cocop_1_1_message_serialiser.html">MessageSerialiser</a>.<a class="code" href="namespace_cocop_1_1_message_serialiser_1_1_meas.html">Meas</a>;</div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Examples</div><div class="line">{</div><div class="line">    <span class="comment">// This example shows how to communicate observations using GetObservationRequest and</span></div><div class="line">    <span class="comment">// GetObservationResponse.</span></div><div class="line">    </div><div class="line">    <span class="keyword">class </span>GetObservationClient</div><div class="line">    {</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> Get()</div><div class="line">        {</div><div class="line">            <span class="comment">// Creating a request object</span></div><div class="line">            var requestObj = <span class="keyword">new</span> MsgMeas.<a class="code" href="class_cocop_1_1_message_serialiser_1_1_meas_1_1_get_observation_request.html">GetObservationRequest</a>();</div><div class="line"></div><div class="line">            <span class="comment">// Setting the conditions of the request</span></div><div class="line">            requestObj.<a name="a0"></a><a class="code" href="class_cocop_1_1_message_serialiser_1_1_meas_1_1_get_observation_request.html#abdf77dfc5450e130f31ad5735e227a5d">FeaturesOfInterest</a>.Add(<span class="stringliteral">&quot;myplant/myprocess/mytemperature&quot;</span>);</div><div class="line"></div><div class="line">            <span class="comment">// Adding a data record; use this to whatever additional parameters you need.</span></div><div class="line">            <span class="comment">// This naturally depends on the server.</span></div><div class="line">            var extensionObj = <span class="keyword">new</span> MsgMeas.Item_DataRecord()</div><div class="line">            {</div><div class="line">                { <span class="stringliteral">&quot;parameter_x&quot;</span>, <span class="keyword">new</span> MsgMeas.Item_Count(3) }</div><div class="line">            };</div><div class="line">            requestObj.Items.Add(extensionObj);</div><div class="line"></div><div class="line">            <span class="comment">// Adding a temporal filter: retrieve all observation after given time</span></div><div class="line">            var tempFilter1 = <span class="keyword">new</span> MsgMeas.TemporalFilter(</div><div class="line">                MsgMeas.TemporalFilter.ValueReferenceType.PhenomenonTime,</div><div class="line">                MsgMeas.TemporalFilter.OperatorType.After,</div><div class="line">                <span class="keyword">new</span> MsgMeas.Item_TimeInstant(DateTime.Parse(<span class="stringliteral">&quot;2018-05-18T08:05:44Z&quot;</span>).ToUniversalTime())</div><div class="line">            );</div><div class="line">            requestObj.TemporalFilters.Add(tempFilter1);</div><div class="line"></div><div class="line">            <span class="comment">// Serialising the request object</span></div><div class="line">            byte[] requestXml = requestObj.ToXmlBytes();</div><div class="line"></div><div class="line">            <span class="comment">// Sending the requestXml to the server and waiting for a response...</span></div><div class="line">            SendRequest(requestXml);</div><div class="line">            byte[] responseXml = WaitForResponse();</div><div class="line"></div><div class="line">            <span class="comment">// Processing the response</span></div><div class="line">            MsgMeas.GetObservationResponse responseObj;</div><div class="line">            <span class="keywordflow">try</span></div><div class="line">            {</div><div class="line">                responseObj = <span class="keyword">new</span> MsgMeas.GetObservationResponse(responseXml);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">catch</span> (MsgMeas.Neutral.InvalidMessageException e)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="stringliteral">&quot;Failed to read server response: &quot;</span> + e.Message, e);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (responseObj.RequestResult != MsgMeas.RequestResultType.Ok)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="stringliteral">&quot;Unexpected response from server&quot;</span>);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">foreach</span> (var obs <span class="keywordflow">in</span> responseObj.Observations)</div><div class="line">            {</div><div class="line">                <span class="comment">// Processing the observations...</span></div><div class="line">                <span class="comment">// ...</span></div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> SendRequest(byte[] requestXml)</div><div class="line">        {</div><div class="line">            <span class="comment">// In real life, you will have to consider where to send.</span></div><div class="line">            <span class="comment">// This depends on the protocol and network structure.</span></div><div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">private</span> byte[] WaitForResponse()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div><div class="line">        }</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keyword">class </span>GetObservationServer</div><div class="line">    {</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> Serve()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">            {</div><div class="line">                <span class="comment">// Waiting for a request to come from the network</span></div><div class="line">                byte[] requestXml = WaitForRequest();</div><div class="line">                MsgMeas.GetObservationRequest requestObj;</div><div class="line">                <span class="keywordflow">try</span></div><div class="line">                {</div><div class="line">                    requestObj = <span class="keyword">new</span> MsgMeas.GetObservationRequest(requestXml);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">catch</span> (MsgMeas.Neutral.InvalidMessageException e)</div><div class="line">                {</div><div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Failed to read request: &quot;</span> + e.Message);</div><div class="line">                    <span class="keywordflow">continue</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// Assuming a certain feature of interest</span></div><div class="line">                <span class="keywordflow">if</span> (!requestObj.FeaturesOfInterest.Contains(<span class="stringliteral">&quot;myplant/myprocess/mytemperature&quot;</span>))</div><div class="line">                {</div><div class="line">                    <span class="comment">// Error!</span></div><div class="line">                    var errorResponse = <span class="keyword">new</span> MsgMeas.GetObservationResponse()</div><div class="line">                    {</div><div class="line">                        RequestResult = MsgMeas.RequestResultType.NotFound</div><div class="line">                    };</div><div class="line">                    SendResponse(errorResponse);</div><div class="line"></div><div class="line">                    <span class="keywordflow">continue</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// Looking at the temporal filter received from the client</span></div><div class="line">                var temporalFilter = requestObj.TemporalFilters[0];</div><div class="line">                </div><div class="line">                <span class="comment">// Retrieving data (e.g., from a database). Filtering with the temporal filter.</span></div><div class="line">                <span class="comment">// ...</span></div><div class="line">                </div><div class="line">                <span class="comment">// Building a response object</span></div><div class="line">                var responseObj = <span class="keyword">new</span> MsgMeas.GetObservationResponse()</div><div class="line">                {</div><div class="line">                    RequestResult = MsgMeas.RequestResultType.Ok</div><div class="line">                };</div><div class="line"></div><div class="line">                <span class="comment">// Setting observation data. Suppose these have been retrieved from a database, for instance.</span></div><div class="line">                var observation1 = <span class="keyword">new</span> MsgMeas.Observation(<span class="keyword">new</span> MsgMeas.Item_Measurement(<span class="stringliteral">&quot;s&quot;</span>, 2.2));</div><div class="line">                var observation2 = <span class="keyword">new</span> MsgMeas.Observation(<span class="keyword">new</span> MsgMeas.Item_Measurement(<span class="stringliteral">&quot;s&quot;</span>, 2.4));</div><div class="line">                responseObj.Observations.Add(observation1);</div><div class="line">                responseObj.Observations.Add(observation2);</div><div class="line"></div><div class="line">                <span class="comment">// Sending the response</span></div><div class="line">                SendResponse(responseObj);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">private</span> byte[] WaitForRequest()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> SendResponse(MsgMeas.GetObservationResponse responseObj)</div><div class="line">        {</div><div class="line">            <span class="comment">// Serialising the object</span></div><div class="line">            byte[] responseXml = responseObj.ToXmlBytes();</div><div class="line"></div><div class="line">            <span class="comment">// Sending the response to the client...</span></div><div class="line">            <span class="comment">// In real life, you will have to consider where to send.</span></div><div class="line">            <span class="comment">// This depends on the protocol and network structure.</span></div><div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer">
<div id="My-FooterOgc">
  <p class="My-FooterNormal">Before using this software, please make sure to read and understand <a href="LICENSE.txt">LICENSE.txt</a>.</p>
  <p class="My-FooterSmall">Although this software is a derivative work from certain standards from the Open Geospatial Consortium, Inc. (OGC&reg;), OGC has <em>not</em> created this software. Furthermore, this software has <em>not</em> been certified for compliance with any OGC standard.</p>
  <p class="My-FooterSmall">Open Geospatial Consortium, Inc.&reg;, OpenGIS&reg; and OGC&reg; are registered trademarks of the Open Geospatial Consortium, Inc.</p>
  <p class="My-FooterSmall">To find the referred OGC standards and/or their licenses, please see the following:</p>
  <table class="My-FooterSmall">
    <tr>
      <td class="My-FooterTd"></td>
      <td class="My-FooterTd">Document Notice</td>
      <td class="My-FooterTd"><a href="ogc_document_notice.txt">ogc_document_notice.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd"></td>
      <td class="My-FooterTd">Software Notice</td>
      <td class="My-FooterTd"><a href="ogc_software_notice.txt">ogc_software_notice.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 09-026r2</td>
      <td class="My-FooterTd">OGC Filter Encoding 2.0 Encoding Standard - With Corrigendum</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_filter.txt">ref_and_license_ogc_filter.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 07-036</td>
      <td class="My-FooterTd">OpenGIS&reg; Geography Markup Language (GML) Encoding Standard</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_gml.txt">ref_and_license_ogc_gml.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 10-025r1</td>
      <td class="My-FooterTd">Observations and Measurements - XML Implementation</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_om.txt">ref_and_license_ogc_om.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 12-006</td>
      <td class="My-FooterTd">OGC&reg; Sensor Observation Service Interface Standard</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_sos.txt">ref_and_license_ogc_sos.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 09-000</td>
      <td class="My-FooterTd">OGC&reg; Sensor Planning Service Implementation Standard</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_sps.txt">ref_and_license_ogc_sps.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 08-094r1</td>
      <td class="My-FooterTd">OGC&reg; SWE Common Data Model Encoding Standard</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_swecommon.txt">ref_and_license_ogc_swecommon.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 09-001</td>
      <td class="My-FooterTd">OpenGIS&reg; SWE Service Model Implementation Standard</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_swes.txt">ref_and_license_ogc_swes.txt</a></td>
    </tr>
    <tr>
      <td class="My-FooterTd">OGC 15-042r3</td>
      <td class="My-FooterTd">TimeseriesML 1.0 - XML Encoding of the Timeseries Profile of Observations and Measurements</td>
      <td class="My-FooterTd"><a href="ref_and_license_ogc_tsml.txt">ref_and_license_ogc_tsml.txt</a></td>
    </tr>
  </table>
</div>
<div id="My-FooterCocop">
  <img src="logos.png" alt="COCOP and EU" />
  <p class="My-FooterSmall">COCOP - Coordinating Optimisation of Complex Industrial Processes<br />
  <a href="https://cocop-spire.eu/">https://cocop-spire.eu/</a></p>
  <p class="My-FooterSmall">This project has received funding from the European Union's Horizon 2020 research and innovation programme under grant agreement No 723661. This piece of software reflects only the authors' views, and the Commission is not responsible for any use that may be made of the information contained therein.</p>
</div>
<small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a>
</small></address>
